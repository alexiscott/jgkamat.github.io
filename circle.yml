machine:
  services:
    - docker

dependencies:
  pre:
      # get ubuntu zenial
    - docker pull ubuntu:zenial

# The test phase dosen't actually run tests. We need the caching from the deploy step.
compile:
  override:
    - docker run -ti -v `pwd`:/root/website ubuntu:zesty 'bash' '-c' 'cd ~/website/src && apt update && apt install -y emacs25-nox && emacs -nw -q --script buildproject.el'

deployment:
  github:
    branch: sources
    commands:
      - git reset --soft master
      - git add $(find -name '*.html' .)
      - git commit -m 'Autoupdate html sources'
      - git push
# experimental:
#   notify:
#     branches:
#       only:
#         - master
